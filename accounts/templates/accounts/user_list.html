<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ユーザー一覧</title>
</head>
<body>
    <h2>ユーザー一覧</h2>

    <!-- 検索フォーム -->
    <form method="get" action="{% url 'user_list' %}">
        <input type="text" name="q" placeholder="名前で検索" value="{{ query }}">

        <select name="role">
            <option value="">すべての役割</option>
            {% for r_value, r_label in ROLE_CHOICES %}
                <option value="{{ r_value }}" {% if role == r_value %}selected{% endif %}>
                    {{ r_label }}
                </option>
            {% endfor %}
        </select>

        <button type="submit">検索</button>
        <button type="submit" onclick="this.form.role.value=''; this.form.q.value='';">すべて表示</button>
    </form>

    <!-- 役割ごとにユーザーを表示 -->
    {% for role_label, profiles in users_by_role.items %}
        <h3>{{ role_label }}</h3>
        <ul>
        {% for profile in profiles %}
            <li>
                <a href="{% url 'user_profile' user_id=profile.user.id %}">{{ profile.name }}</a>
                    {% if request.user.profile.role == "craftsman" and profile.role == "creator" %}
                        | <a href="{% url 'send_scout' creator_id=profile.user.id %}">スカウトを送る</a>
                    {% endif %}
            </li>
        {% empty %}
            <li>該当ユーザーはいません</li>
        {% endfor %}
        </ul>
    {% endfor %}

    <a href="javascript:history.back()">戻る</a>
</body>
</html>
